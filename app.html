<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×× ×”×œ ×”×–×× ×•×ª | ×©×§×™×•×ª ×§×•×§×˜×™×™×œ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c3aed">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="×©×§×™×•×ª ×§×•×§×˜×™×™×œ">
  <link rel="apple-touch-icon" href="icon.svg">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #7c3aed; --primary-dark: #6d28d9; --primary-light: #ede9fe;
      --cyan: #0891b2; --cyan-light: #e0f2fe;
      --green: #059669; --green-light: #d1fae5;
      --amber: #d97706; --amber-light: #fef3c7;
      --blue: #2563eb; --blue-light: #dbeafe;
      --red: #dc2626; --red-light: #fee2e2;
      --gray-50: #f8fafc; --gray-100: #f1f5f9; --gray-200: #e2e8f0;
      --gray-300: #cbd5e1; --gray-400: #94a3b8; --gray-500: #64748b;
      --gray-600: #475569; --gray-700: #334155; --gray-800: #1e293b; --gray-900: #0f172a;
      --shadow: 0 1px 3px rgba(0,0,0,.10); --shadow-md: 0 4px 6px -1px rgba(0,0,0,.10);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.10); --shadow-xl: 0 20px 25px -5px rgba(0,0,0,.15);
      --r: 10px; --rlg: 14px; --rxl: 20px; --rfull: 9999px;
    }
    html { direction: rtl; }
    body { font-family: 'Heebo', sans-serif; background: #eef0fb; color: var(--gray-800); min-height: 100vh; }
    .app { min-height: 100vh; display: flex; flex-direction: column; }

    /* Header */
    .hdr { background: linear-gradient(135deg,#7c3aed,#4338ca); color:#fff; position:sticky; top:0; z-index:100; box-shadow:var(--shadow-lg); }
    .hdr-in { max-width:1440px; margin:0 auto; padding:14px 28px; display:flex; align-items:center; justify-content:space-between; }
    .hdr-logo { display:flex; align-items:center; gap:12px; }
    .hdr-icon { font-size:34px; }
    .hdr-title { font-size:20px; font-weight:700; }
    .hdr-sub { font-size:12px; opacity:.75; }
    .sync-dot { display:inline-block; width:8px; height:8px; border-radius:50%; background:#4ade80; margin-left:6px; animation:pulse 2s infinite; }
    .sync-dot.off { background:#f87171; animation:none; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }

    /* Tabs */
    .tabs { background:#fff; border-bottom:1px solid var(--gray-200); box-shadow:var(--shadow); }
    .tabs-in { max-width:1440px; margin:0 auto; padding:0 28px; display:flex; overflow-x:auto; }
    .tab { padding:14px 22px; font-size:14px; font-weight:500; color:var(--gray-500); background:none; border:none; border-bottom:3px solid transparent; cursor:pointer; font-family:inherit; transition:all .18s; white-space:nowrap; }
    .tab:hover { color:var(--primary); background:var(--primary-light); }
    .tab.act { color:var(--primary); border-bottom-color:var(--primary); font-weight:700; }

    /* Main */
    .main { flex:1; max-width:1440px; margin:0 auto; padding:24px 28px; width:100%; }

    /* Buttons */
    .btn { display:inline-flex; align-items:center; gap:6px; padding:9px 18px; border-radius:var(--r); font-size:14px; font-weight:600; cursor:pointer; border:none; font-family:inherit; transition:all .18s; white-space:nowrap; }
    .btn-white { background:#fff; color:var(--primary); box-shadow:var(--shadow); }
    .btn-white:hover { background:var(--primary-light); transform:translateY(-1px); }
    .btn-violet { background:var(--primary); color:#fff; }
    .btn-violet:hover { background:var(--primary-dark); transform:translateY(-1px); }
    .btn-outline { background:#fff; color:var(--gray-600); border:1.5px solid var(--gray-300); }
    .btn-outline:hover { background:var(--gray-50); }
    .btn-ghost { background:transparent; color:var(--gray-500); padding:6px 10px; border-radius:6px; border:none; cursor:pointer; font-size:14px; font-family:inherit; transition:all .18s; }
    .btn-ghost:hover { background:var(--gray-100); color:var(--gray-700); }
    .btn-del { background:transparent; color:var(--red); padding:6px 10px; border-radius:6px; border:none; cursor:pointer; font-size:14px; font-family:inherit; transition:all .18s; }
    .btn-del:hover { background:var(--red-light); }
    .btn-sm { padding:6px 14px; font-size:13px; }
    .btn-icon { padding:6px 10px; font-size:13px; }

    /* Stats */
    .stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }
    .stat-card { background:#fff; border-radius:var(--rlg); padding:20px; box-shadow:var(--shadow); display:flex; align-items:center; gap:16px; transition:transform .18s,box-shadow .18s; }
    .stat-card:hover { transform:translateY(-2px); box-shadow:var(--shadow-md); }
    .stat-icon { width:52px; height:52px; border-radius:var(--r); display:flex; align-items:center; justify-content:center; font-size:24px; flex-shrink:0; }
    .si-violet { background:var(--primary-light); } .si-cyan { background:var(--cyan-light); }
    .si-green { background:var(--green-light); } .si-amber { background:var(--amber-light); }
    .si-red { background:var(--red-light); }
    .stat-val { font-size:22px; font-weight:700; color:var(--gray-900); }
    .stat-lbl { font-size:13px; color:var(--gray-500); }
    .stat-sub { font-size:11px; color:var(--gray-400); margin-top:2px; }

    /* Status row */
    .status-row { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; }
    .sc { background:#fff; border-radius:var(--rlg); padding:18px 22px; box-shadow:var(--shadow); display:flex; align-items:center; justify-content:space-between; border-right:5px solid transparent; transition:transform .18s; }
    .sc:hover { transform:translateY(-2px); }
    .sc-open { border-right-color:var(--amber); } .sc-ip { border-right-color:var(--blue); } .sc-closed { border-right-color:var(--green); }
    .sc-lbl { font-size:12px; color:var(--gray-500); }
    .sc-val { font-size:32px; font-weight:800; }
    .sc-open .sc-val { color:var(--amber); } .sc-ip .sc-val { color:var(--blue); } .sc-closed .sc-val { color:var(--green); }
    /* Status progress bar */
    .status-progress { display:grid; grid-template-columns:repeat(6,1fr); gap:8px; }
    .sp-item { background:#fff; border-radius:var(--rlg); padding:12px 10px; box-shadow:var(--shadow); display:flex; flex-direction:column; align-items:center; gap:6px; border-top:4px solid transparent; transition:transform .18s; }
    .sp-item:hover { transform:translateY(-2px); }
    .sp-0 { border-top-color:#f59e0b; } .sp-1 { border-top-color:#3b82f6; }
    .sp-2 { border-top-color:#8b5cf6; } .sp-3 { border-top-color:#0891b2; }
    .sp-4 { border-top-color:#10b981; } .sp-5 { border-top-color:#059669; }
    .sp-icon { font-size:22px; }
    .sp-val { font-size:26px; font-weight:800; color:var(--gray-800); }
    .sp-lbl { font-size:10px; font-weight:600; color:var(--gray-500); text-align:center; line-height:1.4; }
    .sc-icon { font-size:30px; opacity:.5; }

    /* Card */
    .card { background:#fff; border-radius:var(--rlg); box-shadow:var(--shadow); overflow:hidden; }
    .card-hdr { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; border-bottom:1px solid var(--gray-100); }
    .card-title { font-size:15px; font-weight:600; color:var(--gray-800); }

    /* Table */
    .tbl-wrap { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; font-size:13.5px; }
    th { background:var(--gray-50); padding:11px 14px; text-align:right; font-size:11.5px; font-weight:700; color:var(--gray-500); text-transform:uppercase; letter-spacing:.4px; border-bottom:1px solid var(--gray-200); white-space:nowrap; }
    td { padding:12px 14px; border-bottom:1px solid var(--gray-100); color:var(--gray-700); white-space:nowrap; }
    tr:last-child td { border-bottom:none; }
    tbody tr:hover td { background:#f8f6ff; }
    tfoot td { padding:10px 14px; }
    .td-b { font-weight:600; color:var(--gray-900); }
    .td-rev { font-weight:700; color:var(--cyan); }
    .td-prof { font-weight:700; color:var(--green); }
    .td-loss { font-weight:700; color:var(--red); }
    .td-c { text-align:center; }
    .td-note { max-width:160px; overflow:hidden; text-overflow:ellipsis; color:var(--gray-500); font-size:12px; }

    /* Badge */
    .badge { display:inline-flex; align-items:center; padding:3px 10px; border-radius:var(--rfull); font-size:12px; font-weight:600; white-space:nowrap; }
    .b-graphics  { background:#fef3c7; color:#78350f; }
    .b-photos    { background:#dbeafe; color:#1e3a8a; }
    .b-printed   { background:#ede9fe; color:#4c1d95; }
    .b-ready     { background:#e0f2fe; color:#075985; }
    .b-delivered { background:#d1fae5; color:#065f46; }
    .b-completed { background:#059669; color:#fff; }
    /* legacy */
    .b-open { background:var(--amber-light); color:#92400e; }
    .b-ip { background:var(--blue-light); color:#1e3a8a; }
    .b-closed { background:#059669; color:#fff; }

    /* Filters */
    .filters { background:#fff; border-radius:var(--rlg); padding:14px 20px; box-shadow:var(--shadow); display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
    .f-lbl { font-size:13px; color:var(--gray-500); font-weight:500; white-space:nowrap; }
    .f-sel { padding:7px 12px; border:1.5px solid var(--gray-200); border-radius:var(--r); font-size:13px; color:var(--gray-700); background:#fff; cursor:pointer; font-family:inherit; outline:none; direction:rtl; transition:border-color .18s; }
    .f-sel:focus { border-color:var(--primary); }
    .f-div { width:1px; height:20px; background:var(--gray-200); }
    .f-count { margin-right:auto; font-size:13px; color:var(--gray-400); font-weight:500; }
    .f-clear { background:var(--gray-100); color:var(--gray-600); border:none; padding:7px 14px; border-radius:var(--r); font-size:13px; cursor:pointer; font-family:inherit; font-weight:500; transition:all .18s; }
    .f-clear:hover { background:var(--gray-200); }
    .sum-bar { background:#fff; border-radius:var(--rlg); padding:12px 20px; box-shadow:var(--shadow); font-size:13px; color:var(--gray-500); }

    /* Empty state */
    .empty { text-align:center; padding:60px 20px; }
    .empty-icon { font-size:52px; opacity:.45; margin-bottom:14px; }
    .empty-txt { font-size:15px; color:var(--gray-500); margin-bottom:20px; }

    /* Modal */
    .overlay { position:fixed; inset:0; background:rgba(15,23,42,.55); z-index:1000; display:flex; align-items:center; justify-content:center; padding:20px; animation:fadeIn .18s ease; backdrop-filter:blur(2px); }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal { background:#fff; border-radius:var(--rxl); width:100%; max-width:700px; max-height:92vh; overflow-y:auto; box-shadow:var(--shadow-xl); animation:slideUp .2s ease; }
    @keyframes slideUp { from{transform:translateY(24px);opacity:0} to{transform:translateY(0);opacity:1} }
    .modal-hdr { display:flex; align-items:center; justify-content:space-between; padding:20px 24px; border-bottom:1px solid var(--gray-200); position:sticky; top:0; background:#fff; z-index:1; border-radius:var(--rxl) var(--rxl) 0 0; }
    .modal-title { font-size:17px; font-weight:700; color:var(--gray-900); }
    .modal-x { width:32px; height:32px; border-radius:var(--rfull); border:none; background:var(--gray-100); color:var(--gray-500); cursor:pointer; font-size:15px; display:flex; align-items:center; justify-content:center; transition:all .18s; }
    .modal-x:hover { background:var(--gray-200); }
    .modal-body { padding:24px; }
    .modal-ftr { display:flex; gap:12px; padding:16px 24px; border-top:1px solid var(--gray-200); background:var(--gray-50); border-radius:0 0 var(--rxl) var(--rxl); }

    /* Form */
    .fg { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .fg-full { grid-column:span 2; }
    .fg-sec { grid-column:span 2; font-size:12px; font-weight:700; color:var(--gray-400); text-transform:uppercase; letter-spacing:.8px; padding-bottom:8px; border-bottom:1px solid var(--gray-200); margin-bottom:4px; }
    .fgroup { display:flex; flex-direction:column; gap:5px; }
    .flbl { font-size:13px; font-weight:600; color:var(--gray-700); }
    .finp, .fsel, .ftxt { padding:9px 12px; border:1.5px solid var(--gray-200); border-radius:var(--r); font-size:14px; color:var(--gray-800); background:#fff; font-family:inherit; outline:none; direction:rtl; width:100%; transition:border-color .18s, box-shadow .18s; }
    .finp:focus, .fsel:focus, .ftxt:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(124,58,237,.10); }
    .ftxt { resize:vertical; min-height:76px; }
    .fhint { font-size:11px; color:var(--gray-400); }
    .finp-ro { background:var(--gray-50); color:var(--gray-500); cursor:default; }

    /* Calc box */
    .calc { background:linear-gradient(135deg,#f8f6ff,#eef0ff); border:1.5px solid #ddd6fe; border-radius:var(--rlg); padding:16px 20px; display:flex; align-items:center; justify-content:space-around; margin-top:18px; gap:12px; flex-wrap:wrap; }
    .ci { display:flex; flex-direction:column; align-items:center; gap:4px; flex:1; min-width:80px; }
    .ci-lbl { font-size:11px; color:var(--gray-500); font-weight:700; text-transform:uppercase; letter-spacing:.5px; text-align:center; }
    .ci-val { font-size:20px; font-weight:800; }
    .ci-rev { color:var(--cyan); } .ci-prof { color:var(--green); } .ci-loss { color:var(--red); } .ci-cost { color:var(--red); }
    .ci-op { font-size:22px; color:var(--gray-300); }

    /* P&L Card */
    .pnl-card { background:#fff; border-radius:var(--rlg); box-shadow:var(--shadow); overflow:hidden; }
    .pnl-hdr { background:linear-gradient(135deg,#1e293b,#334155); color:#fff; padding:16px 20px; display:flex; align-items:center; justify-content:space-between; }
    .pnl-hdr-title { font-size:15px; font-weight:700; }
    .pnl-hdr-sub { font-size:12px; opacity:.6; }
    .pnl-body { padding:0; }
    .pnl-row { display:flex; align-items:center; justify-content:space-between; padding:13px 20px; border-bottom:1px solid var(--gray-100); font-size:14px; }
    .pnl-row:last-child { border-bottom:none; }
    .pnl-row.pnl-total { background:linear-gradient(135deg,#f8f6ff,#eef0ff); font-weight:800; font-size:16px; padding:16px 20px; }
    .pnl-row.pnl-section { background:var(--gray-50); font-size:11px; font-weight:700; color:var(--gray-400); text-transform:uppercase; letter-spacing:.6px; padding:8px 20px; }
    .pnl-label { color:var(--gray-600); display:flex; align-items:center; gap:8px; }
    .pnl-amount { font-weight:700; }
    .pnl-amount.pos { color:var(--green); }
    .pnl-amount.neg { color:var(--red); }
    .pnl-amount.neu { color:var(--gray-700); }
    .pnl-input-wrap { display:flex; align-items:center; gap:8px; }
    .pnl-inp { padding:5px 10px; border:1.5px solid var(--gray-200); border-radius:8px; font-size:13px; font-weight:600; width:110px; text-align:left; direction:ltr; font-family:inherit; outline:none; transition:border-color .18s; }
    .pnl-inp:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(124,58,237,.10); }
    .pnl-divider { height:1px; background:var(--gray-200); margin:0 20px; }

    /* Extra expense rows */
    .exp-row { display:flex; align-items:center; gap:8px; padding:10px 20px; border-bottom:1px solid var(--gray-100); }
    .exp-inp { padding:6px 10px; border:1.5px solid var(--gray-200); border-radius:8px; font-size:13px; font-family:inherit; outline:none; transition:border-color .18s; }
    .exp-inp:focus { border-color:var(--primary); }
    .exp-inp-lbl { flex:1; }
    .exp-inp-amt { width:110px; direction:ltr; text-align:left; }
    .exp-add-btn { display:flex; align-items:center; gap:6px; padding:8px 16px; background:var(--gray-50); border:1.5px dashed var(--gray-300); border-radius:var(--r); font-size:13px; color:var(--gray-500); cursor:pointer; font-family:inherit; font-weight:500; transition:all .18s; width:calc(100% - 40px); justify-content:center; margin:8px 20px; }
    .exp-add-btn:hover { background:var(--primary-light); border-color:var(--primary); color:var(--primary); }

    /* Monthly */
    .month-hdr { padding:14px 20px; background:linear-gradient(135deg,#7c3aed,#4338ca); color:#fff; display:flex; align-items:center; justify-content:space-between; }
    .month-title { font-size:16px; font-weight:700; }
    .month-sub { font-size:12px; opacity:.75; }
    .mini-stats { display:grid; grid-template-columns:repeat(4,1fr); border-bottom:1px solid var(--gray-100); }
    .mini-item { padding:14px 16px; border-left:1px solid var(--gray-100); }
    .mini-item:last-child { border-left:none; }
    .mini-lbl { font-size:11px; color:var(--gray-400); font-weight:600; text-transform:uppercase; }
    .mini-val { font-size:18px; font-weight:700; }
    .v-cyan { color:var(--cyan); } .v-green { color:var(--green); } .v-amber { color:var(--amber); } .v-violet { color:var(--primary); } .v-red { color:var(--red); }
    .sum-grid { display:grid; grid-template-columns:repeat(4,1fr); }
    .sum-item { display:flex; flex-direction:column; align-items:center; padding:16px; border-left:1px solid var(--gray-100); gap:4px; }
    .sum-item:last-child { border-left:none; }
    .sum-val { font-size:22px; font-weight:800; }
    .sum-lbl { font-size:12px; color:var(--gray-500); }
    .section-title { font-size:16px; font-weight:700; color:var(--gray-700); }
    .dash { display:flex; flex-direction:column; gap:20px; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    .phone-link { color:var(--primary); text-decoration:none; font-size:13px; }
    .phone-link:hover { text-decoration:underline; }
    .actions { display:flex; gap:4px; }
    .cursor-p { cursor:pointer; }

    /* Payment toggle */
    .pay-btn { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; border-radius:var(--rfull); font-size:12px; font-weight:700; border:none; cursor:pointer; font-family:inherit; transition:all .15s; white-space:nowrap; }
    .pay-yes { background:var(--green-light); color:#064e3b; }
    .pay-yes:hover { background:#a7f3d0; }
    .pay-no { background:var(--red-light); color:#991b1b; }
    .pay-no:hover { background:#fecaca; }

    /* Setup screen */
    .setup-screen { min-height:100vh; display:flex; align-items:center; justify-content:center; background:#eef0fb; padding:20px; }
    .setup-card { background:#fff; border-radius:24px; box-shadow:var(--shadow-xl); max-width:640px; width:100%; overflow:hidden; }
    .setup-hdr { background:linear-gradient(135deg,#7c3aed,#4338ca); color:#fff; padding:28px 32px; }
    .setup-hdr-title { font-size:22px; font-weight:800; margin-bottom:4px; }
    .setup-hdr-sub { font-size:13px; opacity:.8; }
    .setup-body { padding:28px 32px; }
    .setup-step { display:flex; gap:16px; margin-bottom:22px; align-items:flex-start; }
    .step-num { width:32px; height:32px; border-radius:50%; background:var(--primary-light); color:var(--primary); font-weight:800; font-size:14px; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:2px; }
    .step-content { flex:1; }
    .step-title { font-size:14px; font-weight:700; color:var(--gray-800); margin-bottom:4px; }
    .step-desc { font-size:13px; color:var(--gray-500); line-height:1.6; }
    .step-link { color:var(--primary); font-weight:600; text-decoration:none; }
    .step-link:hover { text-decoration:underline; }

    /* Cocktail chips */
    .cocktail-chips { display:flex; flex-wrap:wrap; gap:5px; }
    .chip { display:inline-flex; align-items:center; padding:2px 9px; border-radius:var(--rfull); font-size:11px; font-weight:600; white-space:nowrap; }
    .chip-0 { background:#fce7f3; color:#9d174d; }
    .chip-1 { background:#e0f2fe; color:#075985; }
    .chip-2 { background:#fef3c7; color:#92400e; }
    .chip-3 { background:#d1fae5; color:#064e3b; }
    .chip-4 { background:#ede9fe; color:#4c1d95; }
    .chip-5 { background:#fee2e2; color:#991b1b; }
    .chip-6 { background:#e0f7fa; color:#006064; }

    /* Cocktail checkbox grid */
    .cocktail-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:4px; }
    .cocktail-cb { display:flex; align-items:center; gap:8px; padding:8px 12px; border:1.5px solid var(--gray-200); border-radius:var(--r); cursor:pointer; transition:all .15s; user-select:none; font-size:13px; font-weight:500; color:var(--gray-700); }
    .cocktail-cb:hover { border-color:var(--primary); background:var(--primary-light); }
    .cocktail-cb.selected { border-color:var(--primary); background:var(--primary-light); color:var(--primary-dark); font-weight:700; }
    .cocktail-cb input[type=checkbox] { width:15px; height:15px; accent-color:var(--primary); cursor:pointer; }

    /* Loading */
    .loading { display:flex; align-items:center; justify-content:min-height:100vh; flex-direction:column; gap:16px; }
    .loading { display:flex; align-items:center; justify-content:center; min-height:100vh; flex-direction:column; gap:16px; }
    .spinner { width:40px; height:40px; border:4px solid var(--primary-light); border-top-color:var(--primary); border-radius:50%; animation:spin .7s linear infinite; }
    @keyframes spin { to{transform:rotate(360deg)} }

    /* Calendar */
    .cal-wrap { padding:0 16px 16px; }
    .cal-nav { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; width:100%; }
    .cal-nav-title { font-size:17px; font-weight:700; color:var(--gray-800); }
    .cal-dow { display:grid; grid-template-columns:repeat(7,1fr); gap:3px; margin-bottom:4px; }
    .cal-dow-cell { text-align:center; font-size:11px; font-weight:700; color:var(--gray-400); padding:4px 0; }
    .cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:3px; }
    .cal-day { min-height:72px; border-radius:8px; padding:5px; border:1.5px solid var(--gray-200); }
    .cal-day.other-month { background:var(--gray-50); opacity:.55; }
    .cal-day.is-today { border-color:var(--primary); background:var(--primary-light); }
    .cal-day-num { font-size:12px; font-weight:600; color:var(--gray-500); margin-bottom:3px; }
    .is-today .cal-day-num { color:var(--primary); font-weight:800; }
    .cal-event { font-size:10px; padding:1px 5px; border-radius:3px; background:var(--primary-light); color:var(--primary-dark); margin-bottom:2px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; cursor:pointer; }
    .cal-event:hover { background:var(--primary); color:#fff; }

    /* Transactions */
    .tx-row { display:flex; align-items:center; gap:12px; padding:12px 20px; border-bottom:1px solid var(--gray-100); }
    .tx-row:last-child { border-bottom:none; }
    .tx-icon { width:36px; height:36px; border-radius:var(--rfull); display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0; }
    .tx-income-bg { background:var(--green-light); }
    .tx-expense-bg { background:var(--red-light); }
    .tx-amt-pos { font-weight:700; color:var(--green); font-size:15px; white-space:nowrap; }
    .tx-amt-neg { font-weight:700; color:var(--red); font-size:15px; white-space:nowrap; }

    /* Team tags */
    .team-tag { display:inline-flex; align-items:center; padding:2px 9px; border-radius:var(--rfull); font-size:11px; font-weight:700; white-space:nowrap; }
    .tag-malachi { background:#fce7f3; color:#9d174d; }
    .tag-yotam { background:#dbeafe; color:#1e3a8a; }
    .tag-tal { background:#d1fae5; color:#065f46; }
    .tag-maya { background:#fef3c7; color:#92400e; }
    .tag-none { background:var(--gray-100); color:var(--gray-400); }

    /* Leaderboard */
    .lb-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .lb-card { background:#fff; border-radius:var(--rlg); padding:20px; box-shadow:var(--shadow); border-top:4px solid transparent; }
    .lb-malachi { border-top-color:#db2777; }
    .lb-yotam { border-top-color:#2563eb; }

    /* Monthly net row */
    .month-net-row { display:flex; align-items:center; justify-content:space-between; padding:10px 20px; background:linear-gradient(135deg,#f0fdf4,#dcfce7); border-top:1px solid var(--gray-100); }

    @media (max-width:900px) { .stats-grid{grid-template-columns:repeat(2,1fr)} .status-row{grid-template-columns:1fr 1fr} .mini-stats{grid-template-columns:repeat(2,1fr)} .main{padding:16px} .two-col{grid-template-columns:1fr} .lb-grid{grid-template-columns:1fr} .status-progress{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:600px) { .fg{grid-template-columns:1fr} .fg-full,.fg-sec{grid-column:span 1} .stats-grid{grid-template-columns:1fr 1fr} .status-row{grid-template-columns:1fr} .status-progress{grid-template-columns:repeat(2,1fr)} }
  </style>
</head>
<body>
<div id="root"></div>

<script>
window.FIREBASE_CONFIG = {
  apiKey: "AIzaSyDHtvTOOSHk_ShqZjyYdTJ2GFex3zcAfLo",
  authDomain: "booze-bags-new.firebaseapp.com",
  databaseURL: "https://booze-bags-new-default-rtdb.firebaseio.com",
  projectId: "booze-bags-new",
  storageBucket: "booze-bags-new.firebasestorage.app",
  messagingSenderId: "686250608499",
  appId: "1:686250608499:web:74a226111873f0e39de706",
  measurementId: "G-1D83FHJ06B"
};
</script>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// â”€â”€ Constants â”€â”€
const BAG_COST_PER_UNIT = 3;
const BAG_COUNTS = [100, 150, 200, 250, 300, 400, 500];
const EVENT_TYPES = ['×—×ª×•× ×”','×‘×¨ ××¦×•×•×”','×‘×ª ××¦×•×•×”','×™×•× ×”×•×œ×“×ª','××¡×™×‘×ª ×§×•×§×˜×™×™×œ','××™×¨×•×¢ ×—×‘×¨×”','××¡×™×‘×ª ×¨×•×•×§×™×/×•×ª','×‘×¨×™×ª','××—×¨'];
const MONTH_NAMES = ['×™× ×•××¨','×¤×‘×¨×•××¨','××¨×¥','××¤×¨×™×œ','×××™','×™×•× ×™','×™×•×œ×™','××•×’×•×¡×˜','×¡×¤×˜××‘×¨','××•×§×˜×•×‘×¨','× ×•×‘××‘×¨','×“×¦××‘×¨'];
const COCKTAIL_TYPES = [
  'Friday at Noot', 'Green Gin', 'Honey & Anis', 'Bazooka Sunrise',
  'Mojito Lychee', 'Queens Margarita', 'Citros Spice',
];
const STATUSES = [
  { id: 'graphics',  label: '×§×™×‘×œ ×”×•×¨××•×ª ×’×¨×¤×™×§×”', icon: 'ğŸ¨' },
  { id: 'photos',    label: '×©×œ×— ×ª××•× ×•×ª ×•××©×¤×˜×™×',  icon: 'ğŸ“¸' },
  { id: 'printed',   label: '×”×•×“×¤×¡',                icon: 'ğŸ–¨ï¸' },
  { id: 'ready',     label: '×©×§×™×•×ª ××•×›× ×•×ª ×•××œ××•×ª', icon: 'ğŸ›ï¸' },
  { id: 'delivered', label: '×”×’×™×¢ ×œ×œ×§×•×—',           icon: 'ğŸšš' },
  { id: 'completed', label: '×”×•×©×œ×',                icon: 'âœ…' },
];
const TEAM = ['××œ××›×™', '×™×•×ª×', '×˜×œ', '×××™×”'];
const DOW_HE = ['×','×‘','×’','×“','×”','×•','×©'];

// â”€â”€ Helpers â”€â”€
const fmt = (n) => `â‚ª${Number(n || 0).toLocaleString('he-IL')}`;
const fmtDate = (s) => { if (!s) return 'â€”'; return new Date(s).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'numeric'}); };
const bagCost = (o) => (Number(o.bagCount)||0) * BAG_COST_PER_UNIT;
const revenue = (o) => (Number(o.packagePrice)||0) + (Number(o.extras)||0);
const profit = (o) => revenue(o) - bagCost(o);
const BadgeClass = {
  graphics:'badge b-graphics', photos:'badge b-photos', printed:'badge b-printed',
  ready:'badge b-ready', delivered:'badge b-delivered', completed:'badge b-completed',
  open:'badge b-open','in-progress':'badge b-ip',closed:'badge b-closed'
};
const StatusLabel = {
  graphics:'×§×™×‘×œ ×”×•×¨××•×ª ×’×¨×¤×™×§×”', photos:'×©×œ×— ×ª××•× ×•×ª ×•××©×¤×˜×™×', printed:'×”×•×“×¤×¡',
  ready:'×©×§×™×•×ª ××•×›× ×•×ª ×•××œ××•×ª', delivered:'×”×’×™×¢ ×œ×œ×§×•×—', completed:'×”×•×©×œ×',
  open:'×¤×ª×•×—×”','in-progress':'×‘×˜×™×¤×•×œ',closed:'×¡×’×•×¨×”'
};
function Badge({status}) { return <span className={BadgeClass[status]||'badge'}>{StatusLabel[status]||status}</span>; }
const TEAM_TAG_CLASS = { '××œ××›×™':'tag-malachi', '×™×•×ª×':'tag-yotam', '×˜×œ':'tag-tal', '×××™×”':'tag-maya' };
function TeamTag({who}) {
  if (!who) return <span className="team-tag tag-none">â€”</span>;
  return <span className={`team-tag ${TEAM_TAG_CLASS[who]||'tag-none'}`}>{who}</span>;
}

// â”€â”€ P&L Card â”€â”€
function PnLCard({ orders, settings, onUpdateSettings }) {
  const totalRev = orders.reduce((a,o)=>a+revenue(o),0);
  const totalBagCost = orders.reduce((a,o)=>a+bagCost(o),0);
  const totalGrossProfit = totalRev - totalBagCost;
  const marketing = Number(settings.marketing)||0;
  const extraItems = settings.extraItems || [];
  const totalExtra = extraItems.reduce((a,e)=>a+(Number(e.amount)||0),0);
  const totalFixed = marketing + totalExtra;
  const netProfit = totalGrossProfit - totalFixed;

  const updateMarketing = (val) => onUpdateSettings({...settings, marketing: Number(val)||0});

  const addExpense = () => {
    const newItems = [...extraItems, {id: Date.now().toString(), label: '×”×•×¦××” ×—×“×©×”', amount: 0}];
    onUpdateSettings({...settings, extraItems: newItems});
  };

  const updateExpense = (idx, field, val) => {
    const newItems = extraItems.map((e,i) => i===idx ? {...e, [field]: field==='amount'?Number(val)||0:val} : e);
    onUpdateSettings({...settings, extraItems: newItems});
  };

  const removeExpense = (idx) => {
    const newItems = extraItems.filter((_,i)=>i!==idx);
    onUpdateSettings({...settings, extraItems: newItems});
  };

  return (
    <div className="pnl-card">
      <div className="pnl-hdr">
        <div>
          <div className="pnl-hdr-title">ğŸ’° ×¨×•×•×— ×•×”×¤×¡×“ â€” ×¡×™×›×•× ×›×•×œ×œ</div>
          <div className="pnl-hdr-sub">×›×•×œ×œ ×¢×œ×•×™×•×ª ×™×™×¦×•×¨ ×•×”×•×¦××•×ª ×§×‘×•×¢×•×ª</div>
        </div>
        <div style={{textAlign:'left',direction:'ltr'}}>
          <div style={{fontSize:22,fontWeight:800,color:netProfit>=0?'#4ade80':'#f87171'}}>{fmt(netProfit)}</div>
          <div style={{fontSize:11,opacity:.7}}>×¨×•×•×— × ×§×™</div>
        </div>
      </div>
      <div className="pnl-body">
        <div className="pnl-row pnl-section"><span>×”×›× ×¡×•×ª</span></div>
        <div className="pnl-row">
          <span className="pnl-label">ğŸ“¥ ×”×›× ×¡×•×ª ××”×–×× ×•×ª ({orders.length})</span>
          <span className="pnl-amount pos">{fmt(totalRev)}</span>
        </div>
        <div className="pnl-row pnl-section"><span>×¢×œ×•×™×•×ª ××©×ª× ×•×ª</span></div>
        <div className="pnl-row">
          <span className="pnl-label">ğŸ›ï¸ ×¢×œ×•×ª ×™×™×¦×•×¨ ×©×§×™×•×ª (â‚ª{BAG_COST_PER_UNIT} Ã— {orders.reduce((a,o)=>a+(Number(o.bagCount)||0),0).toLocaleString('he-IL')})</span>
          <span className="pnl-amount neg">-{fmt(totalBagCost)}</span>
        </div>
        <div className="pnl-row" style={{background:'var(--gray-50)',fontWeight:700}}>
          <span className="pnl-label" style={{fontWeight:700}}>= ×¨×•×•×— ×’×•×œ××™</span>
          <span className="pnl-amount" style={{color:totalGrossProfit>=0?'var(--green)':'var(--red)',fontSize:15}}>{fmt(totalGrossProfit)}</span>
        </div>
        <div className="pnl-row pnl-section"><span>×”×•×¦××•×ª ×§×‘×•×¢×•×ª</span></div>
        <div className="pnl-row">
          <span className="pnl-label">ğŸ“£ ×©×™×•×•×§</span>
          <div className="pnl-input-wrap">
            <span style={{fontSize:13,color:'var(--gray-400)'}}>â‚ª</span>
            <input className="pnl-inp" type="number" min="0" step="100" value={marketing}
              onChange={e=>updateMarketing(e.target.value)} onBlur={e=>updateMarketing(e.target.value)}/>
          </div>
        </div>
        {extraItems.map((exp,idx)=>(
          <div key={exp.id} className="exp-row">
            <span style={{fontSize:13,color:'var(--red)',opacity:.6}}>ğŸ“Œ</span>
            <input className="exp-inp exp-inp-lbl" type="text" value={exp.label}
              onChange={e=>updateExpense(idx,'label',e.target.value)} placeholder="×©× ×”×•×¦××”"/>
            <div style={{display:'flex',alignItems:'center',gap:4}}>
              <span style={{fontSize:13,color:'var(--gray-400)'}}>â‚ª</span>
              <input className="exp-inp exp-inp-amt" type="number" min="0" value={exp.amount}
                onChange={e=>updateExpense(idx,'amount',e.target.value)}/>
            </div>
            <button className="btn-del" style={{padding:'4px 8px'}} onClick={()=>removeExpense(idx)}>ğŸ—‘ï¸</button>
          </div>
        ))}
        <button className="exp-add-btn" onClick={addExpense}>+ ×”×•×¡×£ ×”×•×¦××”</button>
        {totalFixed > 0 && (
          <div className="pnl-row">
            <span className="pnl-label" style={{fontWeight:600}}>×¡×”×´×› ×”×•×¦××•×ª ×§×‘×•×¢×•×ª</span>
            <span className="pnl-amount neg">-{fmt(totalFixed)}</span>
          </div>
        )}
        <div className="pnl-row pnl-total">
          <span style={{color:'var(--gray-800)'}}>ğŸ† ×¨×•×•×— × ×§×™ ×¡×•×¤×™</span>
          <span style={{color:netProfit>=0?'var(--green)':'var(--red)',fontSize:20}}>{fmt(netProfit)}</span>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ Calendar View â”€â”€
function CalendarView({orders, onEdit}) {
  const [cur, setCur] = useState(() => { const d=new Date(); d.setDate(1); return d; });
  const year = cur.getFullYear();
  const month = cur.getMonth();

  const cells = useMemo(() => {
    const firstDow = new Date(year, month, 1).getDay(); // 0=Sun
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const daysInPrev = new Date(year, month, 0).getDate();
    const arr = [];
    for (let i = firstDow-1; i >= 0; i--) arr.push({day: daysInPrev-i, curr:false});
    for (let i = 1; i <= daysInMonth; i++) arr.push({day: i, curr:true});
    while (arr.length % 7 !== 0) arr.push({day: arr.length - daysInMonth - firstDow + 1 + 1, curr:false});
    // fix next month counter
    let nextDay = 1;
    return arr.map((c,i) => c.curr ? c : (i >= firstDow + daysInMonth) ? {day:nextDay++, curr:false} : c);
  }, [year, month]);

  // Fix next-month numbering
  const fixedCells = useMemo(() => {
    const firstDow = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const daysInPrev = new Date(year, month, 0).getDate();
    const arr = [];
    for (let i = firstDow-1; i >= 0; i--) arr.push({day: daysInPrev-i, curr:false});
    for (let i = 1; i <= daysInMonth; i++) arr.push({day: i, curr:true});
    let nd = 1;
    while (arr.length % 7 !== 0) arr.push({day: nd++, curr:false});
    return arr;
  }, [year, month]);

  const today = new Date();
  const isToday = (cell) => cell.curr && cell.day === today.getDate() && month === today.getMonth() && year === today.getFullYear();

  const eventsForDay = (cell) => {
    if (!cell.curr) return [];
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(cell.day).padStart(2,'0')}`;
    return orders.filter(o => o.eventDate === dateStr);
  };

  const monthOrders = useMemo(() => {
    const prefix = `${year}-${String(month+1).padStart(2,'0')}`;
    return orders.filter(o => o.eventDate && o.eventDate.startsWith(prefix));
  }, [orders, year, month]);

  return (
    <div style={{display:'flex',flexDirection:'column',gap:16}}>
      <div className="card">
        <div className="card-hdr" style={{flexDirection:'column',alignItems:'stretch',padding:'16px 20px 12px'}}>
          <div className="cal-nav">
            <button className="btn btn-outline btn-sm" onClick={()=>setCur(new Date(year,month-1,1))}>â†’ ×—×•×“×© ×§×•×“×</button>
            <span className="cal-nav-title">{MONTH_NAMES[month]} {year}</span>
            <button className="btn btn-outline btn-sm" onClick={()=>setCur(new Date(year,month+1,1))}>×—×•×“×© ×”×‘× â†</button>
          </div>
          <div style={{fontSize:12,color:'var(--gray-400)',textAlign:'center',marginTop:4}}>{monthOrders.length} ××™×¨×•×¢×™× ×‘×—×•×“×© ×–×”</div>
        </div>
        <div className="cal-wrap">
          <div className="cal-dow">
            {DOW_HE.map(d=><div key={d} className="cal-dow-cell">{d}</div>)}
          </div>
          <div className="cal-grid">
            {fixedCells.map((cell,i) => {
              const dayEvents = eventsForDay(cell);
              return (
                <div key={i} className={`cal-day ${!cell.curr?'other-month':''} ${isToday(cell)?'is-today':''}`}>
                  <div className="cal-day-num">{cell.day}</div>
                  {dayEvents.map(o=>(
                    <div key={o.id} className="cal-event" title={`${o.customerName} â€” ${o.eventType||''}`} onClick={()=>onEdit(o)}>
                      {o.customerName}
                    </div>
                  ))}
                </div>
              );
            })}
          </div>
        </div>
      </div>
      {monthOrders.length > 0 && (
        <div className="card">
          <div className="card-hdr"><span className="card-title">ğŸ“‹ ××™×¨×•×¢×™× ×‘{MONTH_NAMES[month]}</span></div>
          <div className="tbl-wrap">
            <table>
              <thead><tr><th>×œ×§×•×—</th><th>×ª××¨×™×š</th><th>×¡×•×’ ××™×¨×•×¢</th><th>×©×§×™×•×ª</th><th>×¡×’×¨</th><th>×¡×˜×˜×•×¡</th></tr></thead>
              <tbody>
                {[...monthOrders].sort((a,b)=>new Date(a.eventDate)-new Date(b.eventDate)).map(o=>(
                  <tr key={o.id} className="cursor-p" onClick={()=>onEdit(o)}>
                    <td className="td-b">{o.customerName}</td>
                    <td>{fmtDate(o.eventDate)}</td>
                    <td style={{color:'var(--gray-500)',fontSize:12}}>{o.eventType||'â€”'}</td>
                    <td className="td-c" style={{fontWeight:600}}>{o.bagCount}</td>
                    <td><TeamTag who={o.closedBy}/></td>
                    <td><Badge status={o.status}/></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€ Transactions View â”€â”€
function TransactionsView({transactions, onAdd, onDelete}) {
  const [showForm, setShowForm] = useState(false);
  const today = new Date().toISOString().split('T')[0];
  const [form, setForm] = useState({type:'income', description:'', amount:'', who:'××œ××›×™', date:today});
  const setF = (k,v) => setForm(p=>({...p,[k]:v}));

  const totals = useMemo(() => {
    const income  = transactions.filter(t=>t.type==='income').reduce((a,t)=>a+(Number(t.amount)||0),0);
    const expense = transactions.filter(t=>t.type==='expense').reduce((a,t)=>a+(Number(t.amount)||0),0);
    const byPerson = (name) => ({
      income:  transactions.filter(t=>t.who===name&&t.type==='income').reduce((a,t)=>a+(Number(t.amount)||0),0),
      expense: transactions.filter(t=>t.who===name&&t.type==='expense').reduce((a,t)=>a+(Number(t.amount)||0),0),
    });
    const perPerson = TEAM.reduce((acc,name)=>({...acc,[name]:byPerson(name)}),{});
    return { income, expense, net: income-expense, perPerson };
  }, [transactions]);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!form.description.trim() || !form.amount) return;
    onAdd({...form, amount: Number(form.amount), createdAt: new Date().toISOString()});
    setForm({type:'income', description:'', amount:'', who:'××œ××›×™', date:today});
    setShowForm(false);
  };

  const sorted = [...transactions].sort((a,b)=>new Date(b.createdAt||0)-new Date(a.createdAt||0));

  return (
    <div style={{display:'flex',flexDirection:'column',gap:16}}>
      {/* Summary cards */}
      <div className="stats-grid">
        <div className="stat-card"><div className="stat-icon si-green">ğŸ’°</div><div><div className="stat-val" style={{color:'var(--green)'}}>{fmt(totals.income)}</div><div className="stat-lbl">×¡×”×´×› ×”×›× ×¡×•×ª</div></div></div>
        <div className="stat-card"><div className="stat-icon si-red">ğŸ’¸</div><div><div className="stat-val" style={{color:'var(--red)'}}>{fmt(totals.expense)}</div><div className="stat-lbl">×¡×”×´×› ×”×•×¦××•×ª</div></div></div>
        <div className="stat-card"><div className="stat-icon si-cyan">ğŸ“Š</div><div><div className="stat-val" style={{color:totals.net>=0?'var(--green)':'var(--red)'}}>{fmt(totals.net)}</div><div className="stat-lbl">×××–×Ÿ ×›×•×œ×œ</div></div></div>
        <div className="stat-card"><div className="stat-icon si-violet">ğŸ§¾</div><div><div className="stat-val">{transactions.length}</div><div className="stat-lbl">×¡×”×´×› ×¨×©×•××•×ª</div></div></div>
      </div>

      {/* Per-person summary */}
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:16}}>
        {TEAM.map(name=>{const d=totals.perPerson[name]||{income:0,expense:0};return(
          <div key={name} className="lb-card"
            style={{borderTopColor: name==='××œ××›×™'?'#db2777':name==='×™×•×ª×'?'#2563eb':name==='×˜×œ'?'#059669':'#d97706', borderTopWidth:4, borderTopStyle:'solid'}}>
            <div style={{fontSize:16,fontWeight:800,marginBottom:12}}>{name}</div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:8}}>
              <div><div style={{fontSize:11,color:'var(--gray-400)',fontWeight:700,textTransform:'uppercase',marginBottom:4}}>×”×›× ×™×¡</div><div style={{fontSize:18,fontWeight:800,color:'var(--green)'}}>{fmt(d.income)}</div></div>
              <div><div style={{fontSize:11,color:'var(--gray-400)',fontWeight:700,textTransform:'uppercase',marginBottom:4}}>×”×•×¦×™×</div><div style={{fontSize:18,fontWeight:800,color:'var(--red)'}}>{fmt(d.expense)}</div></div>
              <div><div style={{fontSize:11,color:'var(--gray-400)',fontWeight:700,textTransform:'uppercase',marginBottom:4}}>×××–×Ÿ</div><div style={{fontSize:18,fontWeight:800,color:(d.income-d.expense)>=0?'var(--green)':'var(--red)'}}>{fmt(d.income-d.expense)}</div></div>
            </div>
          </div>
        );})}
      </div>

      {/* Transactions list */}
      <div className="card">
        <div className="card-hdr">
          <span className="card-title">×¨×©×•××•×ª ×”×›× ×¡×•×ª ×•×”×•×¦××•×ª</span>
          <button className="btn btn-violet btn-sm" onClick={()=>setShowForm(p=>!p)}>+ ×”×•×¡×£</button>
        </div>
        {showForm && (
          <form onSubmit={handleSubmit} style={{padding:'14px 20px',borderBottom:'1px solid var(--gray-200)',background:'var(--gray-50)',display:'flex',flexWrap:'wrap',gap:10,alignItems:'flex-end'}}>
            <div className="fgroup" style={{minWidth:120}}>
              <label className="flbl">×¡×•×’</label>
              <select className="fsel" value={form.type} onChange={e=>setF('type',e.target.value)}>
                <option value="income">ğŸ’° ×”×›× ×¡×”</option>
                <option value="expense">ğŸ’¸ ×”×•×¦××”</option>
              </select>
            </div>
            <div className="fgroup" style={{flex:2,minWidth:160}}>
              <label className="flbl">×ª×™××•×¨</label>
              <input className="finp" type="text" placeholder="×ª×™××•×¨..." value={form.description} onChange={e=>setF('description',e.target.value)} required/>
            </div>
            <div className="fgroup" style={{minWidth:110}}>
              <label className="flbl">×¡×›×•× (â‚ª)</label>
              <input className="finp" type="number" min="0" placeholder="0" value={form.amount} onChange={e=>setF('amount',e.target.value)} required dir="ltr" style={{textAlign:'right'}}/>
            </div>
            <div className="fgroup" style={{minWidth:110}}>
              <label className="flbl">××™</label>
              <select className="fsel" value={form.who} onChange={e=>setF('who',e.target.value)}>
                {TEAM.map(t=><option key={t} value={t}>{t}</option>)}
              </select>
            </div>
            <div className="fgroup" style={{minWidth:140}}>
              <label className="flbl">×ª××¨×™×š</label>
              <input className="finp" type="date" value={form.date} onChange={e=>setF('date',e.target.value)}/>
            </div>
            <div style={{display:'flex',gap:8,paddingBottom:2}}>
              <button type="submit" className="btn btn-violet btn-sm">×©××•×¨</button>
              <button type="button" className="btn btn-outline btn-sm" onClick={()=>setShowForm(false)}>×‘×™×˜×•×œ</button>
            </div>
          </form>
        )}
        {sorted.length === 0 ? (
          <div className="empty" style={{padding:'32px 20px'}}>
            <div className="empty-icon">ğŸ’³</div>
            <p className="empty-txt">××™×Ÿ ×¨×©×•××•×ª ×¢×“×™×™×Ÿ â€” ×œ×—×¥ + ×”×•×¡×£</p>
          </div>
        ) : (
          <div>
            {sorted.map(t=>(
              <div key={t.id} className="tx-row">
                <div className={`tx-icon ${t.type==='income'?'tx-income-bg':'tx-expense-bg'}`}>{t.type==='income'?'ğŸ’°':'ğŸ’¸'}</div>
                <div style={{flex:1}}>
                  <div style={{fontSize:14,fontWeight:600,color:'var(--gray-800)'}}>{t.description}</div>
                  <div style={{fontSize:12,color:'var(--gray-400)',marginTop:2}}>{t.date ? fmtDate(t.date) : ''}</div>
                </div>
                <TeamTag who={t.who}/>
                <span className={t.type==='income'?'tx-amt-pos':'tx-amt-neg'}>{t.type==='income'?'+':'-'}{fmt(t.amount)}</span>
                <button className="btn-del" onClick={()=>onDelete(t.id)}>ğŸ—‘ï¸</button>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ Dashboard â”€â”€
function Dashboard({orders, settings, onUpdateSettings, onAdd, onEdit}) {
  const s = useMemo(() => {
    const rev = orders.reduce((a,o)=>a+revenue(o),0);
    const bags = orders.reduce((a,o)=>a+(Number(o.bagCount)||0),0);
    const totalBagCost = bags * BAG_COST_PER_UNIT;
    const marketing = Number(settings.marketing)||0;
    const extraTotal = (settings.extraItems||[]).reduce((a,e)=>a+(Number(e.amount)||0),0);
    const netProfit = rev - totalBagCost - marketing - extraTotal;
    const statusCounts = STATUSES.reduce((acc,s)=>({...acc,[s.id]:orders.filter(o=>o.status===s.id).length}),{});
    statusCounts.graphics += orders.filter(o=>o.status==='open').length;
    statusCounts.photos   += orders.filter(o=>o.status==='in-progress').length;
    statusCounts.completed+= orders.filter(o=>o.status==='closed').length;
    const margin = rev>0 ? Math.round(netProfit/rev*100) : 0;
    // Team stats
    const teamCounts = TEAM.reduce((acc,name)=>({...acc,[name]:orders.filter(o=>o.closedBy===name).length}),{});
    return {total:orders.length,rev,netProfit,bags,statusCounts,margin,teamCounts};
  },[orders, settings]);

  const upcoming = useMemo(()=>{
    const now=new Date(); now.setHours(0,0,0,0);
    const cut=new Date(now.getTime()+60*864e5);
    return orders.filter(o=>{if(!o.eventDate)return false;const d=new Date(o.eventDate);return d>=now&&d<=cut;})
      .sort((a,b)=>new Date(a.eventDate)-new Date(b.eventDate));
  },[orders]);

  const recent = useMemo(()=>[...orders].sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)).slice(0,6),[orders]);

  return (
    <div className="dash">
      <div className="stats-grid">
        {[
          {icon:'ğŸ“¦',val:s.total,lbl:'×¡×”×´×› ×”×–×× ×•×ª',color:'si-violet'},
          {icon:'ğŸ’°',val:fmt(s.rev),lbl:'×”×›× ×¡×•×ª ×›×•×œ×œ×•×ª',color:'si-cyan'},
          {icon:'ğŸ“ˆ',val:fmt(s.netProfit),lbl:'×¨×•×•×— × ×§×™',sub:`××¨×•×•×— ${s.margin}%`,color:'si-green'},
          {icon:'ğŸ›ï¸',val:s.bags.toLocaleString('he-IL'),lbl:'×©×§×™×•×ª ×©× ××›×¨×•',color:'si-amber'},
        ].map(c=>(
          <div key={c.lbl} className="stat-card">
            <div className={`stat-icon ${c.color}`}>{c.icon}</div>
            <div><div className="stat-val">{c.val}</div><div className="stat-lbl">{c.lbl}</div>{c.sub&&<div className="stat-sub">{c.sub}</div>}</div>
          </div>
        ))}
      </div>

      <div className="status-progress">
        {STATUSES.map((st,i)=>(
          <div key={st.id} className={`sp-item sp-${i}`}>
            <span className="sp-icon">{st.icon}</span>
            <span className="sp-val">{s.statusCounts[st.id]||0}</span>
            <span className="sp-lbl">{st.label}</span>
          </div>
        ))}
      </div>

      {/* Team leaderboard */}
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:16}}>
        {TEAM.map(name=>(
          <div key={name} className={`lb-card lb-${name==='××œ××›×™'?'malachi':name==='×™×•×ª×'?'yotam':name==='×˜×œ'?'tal':'maya'}`}
            style={{borderTopColor: name==='××œ××›×™'?'#db2777':name==='×™×•×ª×'?'#2563eb':name==='×˜×œ'?'#059669':'#d97706'}}>
            <div style={{fontSize:13,color:'var(--gray-400)',fontWeight:700,textTransform:'uppercase',letterSpacing:'.5px',marginBottom:8}}>ğŸ† ×¡×’×¨</div>
            <div style={{display:'flex',alignItems:'baseline',gap:8}}>
              <span style={{fontSize:36,fontWeight:800,color:'var(--gray-900)'}}>{s.teamCounts[name]||0}</span>
              <span style={{fontSize:13,color:'var(--gray-500)',fontWeight:600}}>×”×–×× ×•×ª</span>
            </div>
            <div style={{fontSize:16,fontWeight:700,color:'var(--gray-700)',marginTop:4}}>{name}</div>
          </div>
        ))}
      </div>

      {/* P&L Card */}
      <PnLCard orders={orders} settings={settings} onUpdateSettings={onUpdateSettings} />

      <div className="two-col">
        <div className="card">
          <div className="card-hdr"><span className="card-title">â°  ××™×¨×•×¢×™× ×§×¨×•×‘×™× (60 ×™×•×)</span><span style={{fontSize:12,color:'var(--gray-400)'}}>{upcoming.length} ××™×¨×•×¢×™×</span></div>
          {upcoming.length===0 ? (
            <div className="empty" style={{padding:'32px 20px'}}><div className="empty-icon" style={{fontSize:36}}>ğŸ“…</div><p className="empty-txt" style={{fontSize:13}}>××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™×</p></div>
          ) : (
            <div className="tbl-wrap"><table>
              <thead><tr><th>×œ×§×•×—</th><th>×ª××¨×™×š</th><th>×©×§×™×•×ª</th><th>×¡×’×¨</th><th>×¡×˜×˜×•×¡</th></tr></thead>
              <tbody>{upcoming.map(o=>(<tr key={o.id} className="cursor-p" onClick={()=>onEdit(o)}>
                <td className="td-b">{o.customerName}</td>
                <td>{fmtDate(o.eventDate)}</td>
                <td className="td-c" style={{fontWeight:600}}>{o.bagCount}</td>
                <td><TeamTag who={o.closedBy}/></td>
                <td><Badge status={o.status}/></td>
              </tr>))}</tbody>
            </table></div>
          )}
        </div>
        <div className="card">
          <div className="card-hdr"><span className="card-title">ğŸ•’  ×”×–×× ×•×ª ××—×¨×•× ×•×ª</span><button className="btn btn-violet btn-sm" onClick={onAdd}>+ ×”×–×× ×” ×—×“×©×”</button></div>
          {recent.length===0 ? (
            <div className="empty" style={{padding:'32px 20px'}}><div className="empty-icon" style={{fontSize:36}}>ğŸ“‹</div><p className="empty-txt" style={{fontSize:13}}>××™×Ÿ ×”×–×× ×•×ª</p><button className="btn btn-violet btn-sm" onClick={onAdd}>×”×•×¡×£ ×¨××©×•× ×”</button></div>
          ) : (
            <div className="tbl-wrap"><table>
              <thead><tr><th>×œ×§×•×—</th><th>××™×¨×•×¢</th><th>×”×›× ×¡×”</th><th>×¨×•×•×— ×’×•×œ××™</th><th>×¡×’×¨</th><th>×¡×˜×˜×•×¡</th></tr></thead>
              <tbody>{recent.map(o=>{const rev=revenue(o),prof=profit(o);return(
                <tr key={o.id} className="cursor-p" onClick={()=>onEdit(o)}>
                  <td className="td-b">{o.customerName}</td>
                  <td style={{color:'var(--gray-500)',fontSize:12}}>{o.eventType||'â€”'}</td>
                  <td className="td-rev">{fmt(rev)}</td>
                  <td className={prof>=0?'td-prof':'td-loss'}>{fmt(prof)}</td>
                  <td><TeamTag who={o.closedBy}/></td>
                  <td><Badge status={o.status}/></td>
                </tr>);})}</tbody>
            </table></div>
          )}
        </div>
      </div>
    </div>
  );
}

// â”€â”€ Orders Table â”€â”€
function OrdersTable({orders, allOrders, filters, onFilter, onEdit, onDelete, onAdd, onQuickUpdate}) {
  const monthOpts = useMemo(()=>{const s=new Set();allOrders.forEach(o=>{if(o.eventDate)s.add(o.eventDate.substring(0,7));});return[...s].sort().reverse();},[allOrders]);
  const totals = useMemo(()=>orders.reduce((a,o)=>({rev:a.rev+revenue(o),bags:a.bags+(Number(o.bagCount)||0),advPaid:a.advPaid+(o.advancePaid?1:0),balPaid:a.balPaid+(o.balancePaid?1:0)}),{rev:0,bags:0,advPaid:0,balPaid:0}),[orders]);
  const hasF = filters.month||filters.status||filters.closedBy;
  const fmtMo = (ym)=>{const[y,m]=ym.split('-');return`${MONTH_NAMES[parseInt(m)-1]} ${y}`;};

  const PayBtn = ({orderId, field, value}) => (
    <button className={`pay-btn ${value ? 'pay-yes' : 'pay-no'}`}
      onClick={e=>{ e.stopPropagation(); onQuickUpdate(orderId, field, !value); }} title="×œ×—×¥ ×œ×©×™× ×•×™">
      {value ? 'âœ… ×›×Ÿ' : 'âŒ ×œ×'}
    </button>
  );

  return (
    <div style={{display:'flex',flexDirection:'column',gap:16}}>
      <div className="filters">
        <span style={{fontSize:13,fontWeight:700,color:'var(--gray-600)'}}>×¡×™× ×•×Ÿ:</span>
        <span className="f-lbl">×—×•×“×©:</span>
        <select className="f-sel" value={filters.month} onChange={e=>onFilter(p=>({...p,month:e.target.value}))}>
          <option value="">×›×œ ×”×—×•×“×©×™×</option>
          {monthOpts.map(ym=><option key={ym} value={ym}>{fmtMo(ym)}</option>)}
        </select>
        <div className="f-div"/>
        <span className="f-lbl">×¡×˜×˜×•×¡:</span>
        <select className="f-sel" value={filters.status} onChange={e=>onFilter(p=>({...p,status:e.target.value}))}>
          <option value="">×”×›×œ</option>
          {STATUSES.map(s=><option key={s.id} value={s.id}>{s.icon} {s.label}</option>)}
        </select>
        <div className="f-div"/>
        <span className="f-lbl">×¡×’×¨:</span>
        <select className="f-sel" value={filters.closedBy||''} onChange={e=>onFilter(p=>({...p,closedBy:e.target.value}))}>
          <option value="">×”×›×•×œ×</option>
          {TEAM.map(t=><option key={t} value={t}>{t}</option>)}
        </select>
        <span className="f-count">{orders.length} ×”×–×× ×•×ª</span>
        {hasF && <button className="f-clear" onClick={()=>onFilter({month:'',status:'',closedBy:''})}>× ×§×” ×¡×™× ×•×Ÿ âœ•</button>}
      </div>
      {orders.length>0 && (
        <div className="sum-bar">
          ×¡×™×›×•×:{'  '}
          <strong style={{color:'var(--cyan)'}}>×”×›× ×¡×” {fmt(totals.rev)}</strong>{'  '}
          <strong style={{color:'var(--amber)'}}>{totals.bags.toLocaleString('he-IL')} ×©×§×™×•×ª</strong>{'  '}
          <strong style={{color:'var(--green)'}}>××§×“××•×ª ×©×•×œ××•: {totals.advPaid}/{orders.length}</strong>{'  '}
          <strong style={{color:'var(--primary)'}}>×™×ª×¨×•×ª ×©×•×œ××•: {totals.balPaid}/{orders.length}</strong>
        </div>
      )}
      <div className="card">
        <div className="card-hdr"><span className="card-title">×¨×©×™××ª ×”×–×× ×•×ª</span><button className="btn btn-violet btn-sm" onClick={onAdd}>+ ×”×–×× ×” ×—×“×©×”</button></div>
        {orders.length===0 ? (
          <div className="empty"><div className="empty-icon">ğŸ”</div><p className="empty-txt">{hasF?'××™×Ÿ ×”×–×× ×•×ª ×”×ª×•×××•×ª ××ª ×”×¡×™× ×•×Ÿ':'××™×Ÿ ×”×–×× ×•×ª ×¢×“×™×™×Ÿ'}</p>{!hasF&&<button className="btn btn-violet" onClick={onAdd}>×”×•×¡×£ ×”×–×× ×” ×¨××©×•× ×”</button>}</div>
        ) : (
          <div className="tbl-wrap"><table>
            <thead><tr><th>×©× ×œ×§×•×—</th><th>×˜×œ×¤×•×Ÿ</th><th>×ª××¨×™×š ××™×¨×•×¢</th><th>×¡×•×’ ××™×¨×•×¢</th><th>×›××•×ª ×©×§×™×•×ª</th><th>××—×™×¨ ×—×‘×™×œ×”</th><th>×¡×•×’×™ ×§×•×§×˜×™×™×œ×™×</th><th>××§×“××” ×©×•×œ××”</th><th>×™×ª×¨×” ×©×•×œ××”</th><th>×¡×’×¨</th><th>×¡×˜×˜×•×¡</th><th>×”×¢×¨×•×ª</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
            <tbody>{orders.map(o=>{const ctypes=Array.isArray(o.cocktailTypes)?o.cocktailTypes:[];return(
              <tr key={o.id}>
                <td className="td-b">{o.customerName}</td>
                <td>{o.phone?<a className="phone-link" href={`tel:${o.phone}`}>{o.phone}</a>:'â€”'}</td>
                <td>{fmtDate(o.eventDate)}</td>
                <td>{o.eventType||'â€”'}</td>
                <td className="td-c" style={{fontWeight:600}}>{o.bagCount}</td>
                <td>{fmt(o.packagePrice)}</td>
                <td style={{minWidth:160}}>{ctypes.length>0?(<div className="cocktail-chips">{ctypes.map((ct)=><span key={ct} className={`chip chip-${COCKTAIL_TYPES.indexOf(ct)%7}`}>{ct}</span>)}</div>):<span style={{color:'var(--gray-400)'}}>â€”</span>}</td>
                <td className="td-c"><PayBtn orderId={o.id} field="advancePaid" value={!!o.advancePaid}/></td>
                <td className="td-c"><PayBtn orderId={o.id} field="balancePaid" value={!!o.balancePaid}/></td>
                <td><TeamTag who={o.closedBy}/></td>
                <td><Badge status={o.status}/></td>
                <td className="td-note" title={o.notes||''}>{o.notes||'â€”'}</td>
                <td><div className="actions"><button className="btn-ghost" onClick={()=>onEdit(o)}>âœï¸</button><button className="btn-del" onClick={()=>onDelete(o.id)}>ğŸ—‘ï¸</button></div></td>
              </tr>);})}</tbody>
          </table></div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ Order Form â”€â”€
const EMPTY = {customerName:'',phone:'',eventDate:'',eventType:'',bagCount:300,packagePrice:'',extras:'',status:'graphics',notes:'',advancePaid:false,balancePaid:false,cocktailTypes:[],closedBy:''};
function OrderForm({order, onSave, onClose}) {
  const [f, setF] = useState(()=> order ? {
    customerName:order.customerName||'',
    phone:order.phone||'',
    eventDate:order.eventDate||'',
    eventType:order.eventType||'',
    bagCount:order.bagCount||300,
    packagePrice:order.packagePrice===0?0:order.packagePrice||'',
    extras:order.extras||'',
    status:order.status||'open',
    notes:order.notes||'',
    advancePaid:!!order.advancePaid,
    balancePaid:!!order.balancePaid,
    cocktailTypes: Array.isArray(order.cocktailTypes) ? order.cocktailTypes : [],
    closedBy: order.closedBy||''
  } : {...EMPTY});

  const set = (k,v) => setF(p=>({...p,[k]:v}));
  const rev = (Number(f.packagePrice)||0) + (Number(f.extras)||0);
  const cost = (Number(f.bagCount)||0) * BAG_COST_PER_UNIT;
  const prof = rev - cost;

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!f.customerName.trim()) { alert('× × ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—'); return; }
    onSave({
      customerName:f.customerName.trim(), phone:f.phone.trim(), eventDate:f.eventDate,
      eventType:f.eventType, bagCount:Number(f.bagCount), packagePrice:Number(f.packagePrice)||0,
      extras:Number(f.extras)||0, status:f.status, notes:f.notes.trim(),
      advancePaid:!!f.advancePaid, balancePaid:!!f.balancePaid,
      cocktailTypes:f.cocktailTypes||[], closedBy:f.closedBy||''
    });
  };

  return (
    <div className="overlay" onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
      <div className="modal">
        <div className="modal-hdr"><h2 className="modal-title">{order?'âœï¸  ×¢×¨×™×›×ª ×”×–×× ×”':'â•  ×”×–×× ×” ×—×“×©×”'}</h2><button className="modal-x" onClick={onClose}>âœ•</button></div>
        <form onSubmit={handleSubmit}>
          <div className="modal-body">
            <div className="fg">
              <div className="fg-sec">×¤×¨×˜×™ ×œ×§×•×—</div>
              <div className="fgroup"><label className="flbl">×©× ×œ×§×•×— *</label><input className="finp" type="text" placeholder="×©× ××œ×" value={f.customerName} onChange={e=>set('customerName',e.target.value)} required autoFocus/></div>
              <div className="fgroup"><label className="flbl">×˜×œ×¤×•×Ÿ</label><input className="finp" type="tel" placeholder="050-0000000" value={f.phone} onChange={e=>set('phone',e.target.value)} dir="ltr" style={{textAlign:'right'}}/></div>
              <div className="fg-sec">×¤×¨×˜×™ ×”××™×¨×•×¢</div>
              <div className="fgroup"><label className="flbl">×ª××¨×™×š ××™×¨×•×¢</label><input className="finp" type="date" value={f.eventDate} onChange={e=>set('eventDate',e.target.value)}/></div>
              <div className="fgroup"><label className="flbl">×¡×•×’ ××™×¨×•×¢</label><select className="fsel" value={f.eventType} onChange={e=>set('eventType',e.target.value)}><option value="">×‘×—×¨ ×¡×•×’ ××™×¨×•×¢</option>{EVENT_TYPES.map(t=><option key={t} value={t}>{t}</option>)}</select></div>
              <div className="fgroup"><label className="flbl">×›××•×ª ×©×§×™×•×ª</label><select className="fsel" value={f.bagCount} onChange={e=>set('bagCount',e.target.value)}>{BAG_COUNTS.map(n=><option key={n} value={n}>{n} ×©×§×™×•×ª</option>)}</select></div>
              <div className="fgroup"><label className="flbl">×¡×˜×˜×•×¡</label><select className="fsel" value={f.status} onChange={e=>set('status',e.target.value)}>
                {STATUSES.map(s=><option key={s.id} value={s.id}>{s.icon}  {s.label}</option>)}
              </select></div>
              <div className="fgroup"><label className="flbl">××™ ×¡×’×¨ ××ª ×”×”×–×× ×”</label>
                <select className="fsel" value={f.closedBy} onChange={e=>set('closedBy',e.target.value)}>
                  <option value="">â€” ×œ× ×”×•×’×“×¨ â€”</option>
                  {TEAM.map(t=><option key={t} value={t}>{t}</option>)}
                </select>
              </div>
              <div className="fg-sec">×ª×©×œ×•××™×</div>
              <div className="fgroup">
                <label className="flbl">××§×“××” ×©×•×œ××”</label>
                <button type="button" className={`pay-btn ${f.advancePaid?'pay-yes':'pay-no'}`} style={{width:'100%',justifyContent:'center',padding:'8px'}} onClick={()=>set('advancePaid',!f.advancePaid)}>
                  {f.advancePaid ? 'âœ… ×›×Ÿ â€” ×©×•×œ××”' : 'âŒ ×œ× â€” ×˜×¨× ×©×•×œ××”'}
                </button>
              </div>
              <div className="fgroup">
                <label className="flbl">×™×ª×¨×” ×©×•×œ××”</label>
                <button type="button" className={`pay-btn ${f.balancePaid?'pay-yes':'pay-no'}`} style={{width:'100%',justifyContent:'center',padding:'8px'}} onClick={()=>set('balancePaid',!f.balancePaid)}>
                  {f.balancePaid ? 'âœ… ×›×Ÿ â€” ×©×•×œ××”' : 'âŒ ×œ× â€” ×˜×¨× ×©×•×œ××”'}
                </button>
              </div>
              <div className="fg-sec">×¡×•×’×™ ×§×•×§×˜×™×™×œ×™×</div>
              <div className="fgroup fg-full">
                <label className="flbl">×‘×—×¨ ×§×•×§×˜×™×™×œ×™× (× ×™×ª×Ÿ ×œ×‘×—×•×¨ ××¡×¤×¨)</label>
                <div className="cocktail-grid">
                  {COCKTAIL_TYPES.map((ct,i) => {
                    const selected = (f.cocktailTypes||[]).includes(ct);
                    return (
                      <label key={ct} className={`cocktail-cb ${selected?'selected':''}`}>
                        <input type="checkbox" checked={selected} onChange={()=>{
                          const cur = f.cocktailTypes||[];
                          set('cocktailTypes', selected ? cur.filter(x=>x!==ct) : [...cur, ct]);
                        }}/>
                        <span className={`chip chip-${i%7}`}>{ct}</span>
                      </label>
                    );
                  })}
                </div>
              </div>
              <div className="fg-sec">×›×¡×¤×™×</div>
              <div className="fgroup"><label className="flbl">××—×™×¨ ×—×‘×™×œ×” (â‚ª)</label><input className="finp" type="number" min="0" step="1" placeholder="0" value={f.packagePrice} onChange={e=>set('packagePrice',e.target.value)} dir="ltr" style={{textAlign:'right'}}/></div>
              <div className="fgroup"><label className="flbl">×ª×•×¡×¤×•×ª (â‚ª)</label><input className="finp" type="number" min="0" step="1" placeholder="0" value={f.extras} onChange={e=>set('extras',e.target.value)} dir="ltr" style={{textAlign:'right'}}/><span className="fhint">×©×“×¨×•×’×™×, ×ª×•×¡×¤×•×ª ××™×•×—×“×•×ª</span></div>
              <div className="fgroup fg-full"><label className="flbl">×”×¢×¨×•×ª</label><textarea className="ftxt" placeholder="×”×¢×¨×•×ª, ×‘×§×©×•×ª ××™×•×—×“×•×ª..." value={f.notes} onChange={e=>set('notes',e.target.value)}/></div>
            </div>
            <div className="calc">
              <div className="ci"><span className="ci-lbl">××—×™×¨ ×—×‘×™×œ×”</span><span className="ci-val" style={{color:'var(--gray-700)',fontSize:17}}>{fmt(f.packagePrice)}</span></div>
              <span className="ci-op">+</span>
              <div className="ci"><span className="ci-lbl">×ª×•×¡×¤×•×ª</span><span className="ci-val" style={{color:'var(--gray-700)',fontSize:17}}>{fmt(f.extras)}</span></div>
              <span className="ci-op">=</span>
              <div className="ci"><span className="ci-lbl">×”×›× ×¡×”</span><span className="ci-val ci-rev">{fmt(rev)}</span></div>
              <span className="ci-op">âˆ’</span>
              <div className="ci"><span className="ci-lbl">×¢×œ×•×ª ×™×™×¦×•×¨<br/><span style={{fontSize:10,fontWeight:400,color:'var(--gray-400)'}}>({f.bagCount}Ã—â‚ª{BAG_COST_PER_UNIT})</span></span><span className="ci-val ci-cost">-{fmt(cost)}</span></div>
              <span className="ci-op">=</span>
              <div className="ci"><span className="ci-lbl">×¨×•×•×— ×’×•×œ××™</span><span className={`ci-val ${prof>=0?'ci-prof':'ci-loss'}`}>{fmt(prof)}</span></div>
            </div>
          </div>
          <div className="modal-ftr">
            <button type="submit" className="btn btn-violet">{order?'ğŸ’¾  ×©××•×¨ ×©×™× ×•×™×™×':'âœ…  ×”×•×¡×£ ×”×–×× ×”'}</button>
            <button type="button" className="btn btn-outline" onClick={onClose}>×‘×™×˜×•×œ</button>
          </div>
        </form>
      </div>
    </div>
  );
}

// â”€â”€ Monthly Stats â”€â”€
function MonthlyStats({orders, settings, onUpdateSettings}) {
  const marketing = Number(settings.marketing)||0;
  const extraTotal = (settings.extraItems||[]).reduce((a,e)=>a+(Number(e.amount)||0),0);
  const totalFixed = marketing + extraTotal;
  const monthlyFixed = Number(settings.monthlyFixed)||0;

  const monthly = useMemo(()=>{
    const m={};
    orders.forEach(o=>{if(!o.eventDate)return;const ym=o.eventDate.substring(0,7);if(!m[ym])m[ym]={ym,orders:[],rev:0,prof:0,bags:0,cost:0};m[ym].orders.push(o);m[ym].rev+=revenue(o);m[ym].prof+=profit(o);m[ym].bags+=Number(o.bagCount)||0;m[ym].cost+=bagCost(o);});
    return Object.values(m).sort((a,b)=>b.ym.localeCompare(a.ym));
  },[orders]);

  const totals = useMemo(()=>monthly.reduce((a,m)=>({orders:a.orders+m.orders.length,rev:a.rev+m.rev,prof:a.prof+m.prof,bags:a.bags+m.bags,cost:a.cost+m.cost}),{orders:0,rev:0,prof:0,bags:0,cost:0}),[monthly]);
  const getLabel = (ym)=>{const[y,mo]=ym.split('-');return`${MONTH_NAMES[parseInt(mo)-1]} ${y}`;};

  if(monthly.length===0) return <div className="card"><div className="empty"><div className="empty-icon">ğŸ“…</div><p className="empty-txt">××™×Ÿ × ×ª×•× ×™× ×œ×¡×™×›×•× ×—×•×“×©×™</p></div></div>;

  const netProfit = totals.prof - totalFixed;
  const margin = totals.rev>0?Math.round(netProfit/totals.rev*100):0;

  return (
    <div style={{display:'flex',flexDirection:'column',gap:16}}>
      {/* Monthly fixed cost setting */}
      <div className="card">
        <div className="card-hdr">
          <span className="card-title">âš™ï¸ ×”×’×“×¨×•×ª ×¡×™×›×•× ×—×•×“×©×™</span>
        </div>
        <div style={{padding:'14px 20px',display:'flex',alignItems:'center',gap:12,flexWrap:'wrap'}}>
          <label className="flbl">×”×•×¦××•×ª ×§×‘×•×¢×•×ª ×—×•×“×©×™×•×ª (â‚ª):</label>
          <div style={{display:'flex',alignItems:'center',gap:6}}>
            <span style={{fontSize:13,color:'var(--gray-400)'}}>â‚ª</span>
            <input
              className="pnl-inp"
              type="number" min="0" step="100"
              value={monthlyFixed}
              onChange={e=>onUpdateSettings({...settings, monthlyFixed: Number(e.target.value)||0})}
              placeholder="0"
            />
          </div>
          <span style={{fontSize:12,color:'var(--gray-400)'}}>â€” ×™× ×•×›×” ××”×¨×•×•×— ×”×’×•×œ××™ ×©×œ ×›×œ ×—×•×“×© ×œ×—×™×©×•×‘ ×”×¨×•×•×— ×”× ×§×™</span>
        </div>
      </div>

      <div className="card">
        <div className="card-hdr">
          <span className="card-title">×¡×™×›×•× ×›×•×œ×œ</span>
          <span style={{fontSize:12,color:'var(--gray-400)'}}>××¨×•×•×— × ×§×™: {margin}%</span>
        </div>
        <div className="sum-grid">
          <div className="sum-item"><span className="sum-val v-violet">{totals.orders}</span><span className="sum-lbl">×”×–×× ×•×ª</span></div>
          <div className="sum-item"><span className="sum-val v-cyan">{fmt(totals.rev)}</span><span className="sum-lbl">×”×›× ×¡×•×ª</span></div>
          <div className="sum-item"><span className="sum-val v-green">{fmt(totals.prof)}</span><span className="sum-lbl">×¨×•×•×— ×’×•×œ××™</span></div>
          <div className="sum-item"><span className="sum-val v-amber">{totals.bags.toLocaleString('he-IL')}</span><span className="sum-lbl">×©×§×™×•×ª</span></div>
        </div>
        {totalFixed > 0 && (
          <div style={{padding:'12px 20px',borderTop:'1px solid var(--gray-100)',display:'flex',flexDirection:'column',gap:6}}>
            <div style={{fontSize:12,fontWeight:700,color:'var(--gray-400)',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:4}}>×”×¤×—×ª×ª ×”×•×¦××•×ª ×§×‘×•×¢×•×ª</div>
            {marketing > 0 && <div style={{display:'flex',justifyContent:'space-between',fontSize:13,color:'var(--gray-600)'}}><span>ğŸ“£ ×©×™×•×•×§</span><span style={{color:'var(--red)',fontWeight:600}}>-{fmt(marketing)}</span></div>}
            {(settings.extraItems||[]).filter(e=>e.amount>0).map((e,i)=>(
              <div key={i} style={{display:'flex',justifyContent:'space-between',fontSize:13,color:'var(--gray-600)'}}><span>ğŸ“Œ {e.label}</span><span style={{color:'var(--red)',fontWeight:600}}>-{fmt(e.amount)}</span></div>
            ))}
            <div style={{display:'flex',justifyContent:'space-between',fontSize:15,fontWeight:800,marginTop:6,paddingTop:8,borderTop:'1px solid var(--gray-200)'}}>
              <span>ğŸ† ×¨×•×•×— × ×§×™</span>
              <span style={{color:netProfit>=0?'var(--green)':'var(--red)'}}>{fmt(netProfit)}</span>
            </div>
          </div>
        )}
      </div>

      <h2 className="section-title">×¤×™×¨×•×˜ ×œ×¤×™ ×—×•×“×©×™×</h2>
      {monthly.map(m=>{
        const monthMargin=m.rev>0?Math.round(m.prof/m.rev*100):0;
        const monthNet = m.prof - monthlyFixed;
        return (<div key={m.ym} className="card">
          <div className="month-hdr">
            <div><div className="month-title">{getLabel(m.ym)}</div><div className="month-sub">{m.orders.length} ×”×–×× ×•×ª â€¢ ××¨×•×•×— ×’×•×œ××™ {monthMargin}%</div></div>
            <div style={{textAlign:'left',direction:'ltr'}}>
              <div style={{fontSize:20,fontWeight:800}}>{fmt(monthNet)}</div>
              <div style={{fontSize:11,opacity:.7}}>×¨×•×•×— × ×§×™ ×—×•×“×©×™</div>
            </div>
          </div>
          <div className="mini-stats">
            <div className="mini-item"><div className="mini-lbl">×”×›× ×¡×”</div><div className="mini-val v-cyan">{fmt(m.rev)}</div></div>
            <div className="mini-item"><div className="mini-lbl">×¢×œ×•×ª ×™×™×¦×•×¨</div><div className="mini-val v-red">-{fmt(m.cost)}</div></div>
            <div className="mini-item"><div className="mini-lbl">×¨×•×•×— ×’×•×œ××™</div><div className={`mini-val ${m.prof>=0?'v-green':''}`} style={m.prof<0?{color:'var(--red)'}:{}}>{fmt(m.prof)}</div></div>
            <div className="mini-item"><div className="mini-lbl">×©×§×™×•×ª</div><div className="mini-val v-amber">{m.bags.toLocaleString('he-IL')}</div></div>
          </div>
          {monthlyFixed > 0 && (
            <div className="month-net-row">
              <span style={{fontSize:13,color:'var(--gray-600)',fontWeight:600}}>ğŸ“Œ ×”×•×¦××•×ª ×§×‘×•×¢×•×ª ×—×•×“×©×™×•×ª: <span style={{color:'var(--red)'}}>-{fmt(monthlyFixed)}</span></span>
              <span style={{fontSize:15,fontWeight:800,color:monthNet>=0?'var(--green)':'var(--red)'}}>
                ×¨×•×•×— × ×§×™: {fmt(monthNet)}
              </span>
            </div>
          )}
          <div className="tbl-wrap"><table>
            <thead><tr><th>×œ×§×•×—</th><th>×¡×•×’ ××™×¨×•×¢</th><th>×©×§×™×•×ª</th><th>××—×™×¨ ×—×‘×™×œ×”</th><th>×ª×•×¡×¤×•×ª</th><th>×”×›× ×¡×”</th><th>×¢×œ×•×ª ×™×™×¦×•×¨</th><th>×¨×•×•×— ×’×•×œ××™</th><th>×¡×’×¨</th><th>×¡×˜×˜×•×¡</th></tr></thead>
            <tbody>{[...m.orders].sort((a,b)=>new Date(a.eventDate)-new Date(b.eventDate)).map(o=>{const rev=revenue(o),prof=profit(o),cost=bagCost(o);return(
              <tr key={o.id}>
                <td className="td-b">{o.customerName}</td>
                <td style={{color:'var(--gray-500)',fontSize:12}}>{o.eventType||'â€”'}</td>
                <td className="td-c" style={{fontWeight:600}}>{o.bagCount}</td>
                <td>{fmt(o.packagePrice)}</td>
                <td style={{color:o.extras>0?'inherit':'var(--gray-400)'}}>{o.extras>0?fmt(o.extras):'â€”'}</td>
                <td className="td-rev">{fmt(rev)}</td>
                <td style={{color:'var(--red)',fontWeight:600}}>-{fmt(cost)}</td>
                <td className={prof>=0?'td-prof':'td-loss'}>{fmt(prof)}</td>
                <td><TeamTag who={o.closedBy}/></td>
                <td><Badge status={o.status}/></td>
              </tr>);})}</tbody>
            <tfoot><tr style={{background:'var(--gray-50)'}}>
              <td colSpan={7} style={{fontWeight:700,color:'var(--gray-600)',fontSize:12}}>×¡×”×´×› ×—×•×“×©</td>
              <td className={m.prof>=0?'td-prof':'td-loss'}>{fmt(m.prof)}</td>
              <td/><td/>
            </tr></tfoot>
          </table></div>
        </div>);
      })}
    </div>
  );
}

// â”€â”€ Main App â”€â”€
function App() {
  const [db, setDb] = useState(() => {
    try {
      if (!firebase.apps.length) firebase.initializeApp(window.FIREBASE_CONFIG);
      return firebase.database();
    } catch(e) { return null; }
  });
  const [orders, setOrders] = useState([]);
  const [transactions, setTransactions] = useState([]);
  const [settings, setSettings] = useState({marketing: 2500, extraItems: [], monthlyFixed: 0});
  const [loading, setLoading] = useState(false);
  const [connected, setConnected] = useState(false);
  const [tab, setTab] = useState('dashboard');
  const [showForm, setShowForm] = useState(false);
  const [editing, setEditing] = useState(null);
  const [filters, setFilters] = useState({month:'',status:'',closedBy:''});

  useEffect(() => {
    if (!db) return;
    setLoading(true);

    const connRef = db.ref('.info/connected');
    connRef.on('value', snap => setConnected(snap.val() === true));

    const ordersRef = db.ref('orders');
    ordersRef.on('value', snap => {
      const data = snap.val() || {};
      const arr = Object.entries(data).map(([id, o]) => ({...o, id}));
      arr.sort((a, b) => new Date(b.createdAt||0) - new Date(a.createdAt||0));
      setOrders(arr);
      setLoading(false);
    });

    const settingsRef = db.ref('settings');
    settingsRef.on('value', snap => {
      const data = snap.val();
      if (data) {
        setSettings({
          marketing: data.marketing !== undefined ? data.marketing : 2500,
          extraItems: data.extraItems ? Object.values(data.extraItems) : [],
          monthlyFixed: data.monthlyFixed !== undefined ? data.monthlyFixed : 0,
        });
      }
    });

    const txRef = db.ref('transactions');
    txRef.on('value', snap => {
      const data = snap.val() || {};
      const arr = Object.entries(data).map(([id, t]) => ({...t, id}));
      setTransactions(arr);
    });

    return () => { connRef.off(); ordersRef.off(); settingsRef.off(); txRef.off(); };
  }, [db]);

  const handleUpdateSettings = (newSettings) => {
    if (!db) return;
    setSettings(newSettings);
    const toSave = {
      marketing: newSettings.marketing,
      monthlyFixed: newSettings.monthlyFixed || 0,
      extraItems: newSettings.extraItems.reduce((acc,item,i) => ({...acc, [item.id||i]: item}), {})
    };
    db.ref('settings').set(toSave);
  };

  const filtered = useMemo(() => orders.filter(o => {
    if (filters.month && o.eventDate?.substring(0,7) !== filters.month) return false;
    if (filters.status && o.status !== filters.status) return false;
    if (filters.closedBy && o.closedBy !== filters.closedBy) return false;
    return true;
  }).sort((a,b) => {
    if (!a.eventDate) return 1; if (!b.eventDate) return -1;
    return new Date(a.eventDate) - new Date(b.eventDate);
  }), [orders, filters]);

  const handleSave = (data) => {
    if (!db) return;
    const ordersRef = db.ref('orders');
    if (editing) {
      ordersRef.child(editing.id).set({...data, createdAt: editing.createdAt || new Date().toISOString()});
    } else {
      ordersRef.push({...data, createdAt: new Date().toISOString()});
    }
    setShowForm(false); setEditing(null);
  };

  const handleDelete = (id) => {
    if (!db) return;
    if (window.confirm('×”×× ×œ××—×•×§ ××ª ×”×”×–×× ×”?')) db.ref('orders').child(id).remove();
  };

  const handleQuickUpdate = (id, field, value) => {
    if (!db) return;
    db.ref('orders').child(id).update({[field]: value});
  };

  const handleAddTransaction = (data) => {
    if (!db) return;
    db.ref('transactions').push(data);
  };

  const handleDeleteTransaction = (id) => {
    if (!db) return;
    if (window.confirm('×œ××—×•×§ ×¨×©×•××” ×–×•?')) db.ref('transactions').child(id).remove();
  };

  const handleEdit = (o) => { setEditing(o); setShowForm(true); };
  const handleAdd = () => { setEditing(null); setShowForm(true); };
  const handleClose = () => { setShowForm(false); setEditing(null); };

  if (!db) return <div className="loading"><div className="spinner"/></div>;

  if (loading) return (
    <div className="loading">
      <div className="spinner"/>
      <div style={{color:'var(--gray-500)',fontSize:14}}>××ª×—×‘×¨ ×œ×¢× ×Ÿ...</div>
    </div>
  );

  const TABS = [
    {id:'dashboard', label:'ğŸ“Š  ×“×©×‘×•×¨×“'},
    {id:'orders',    label:'ğŸ“‹  ×”×–×× ×•×ª'},
    {id:'monthly',   label:'ğŸ“…  ×¡×™×›×•× ×—×•×“×©×™'},
    {id:'calendar',  label:'ğŸ—“ï¸  ×™×•××Ÿ'},
    {id:'finance',   label:'ğŸ’³  ×”×•×¦××•×ª/×”×›× ×¡×•×ª'},
  ];

  return (
    <div className="app">
      <header className="hdr">
        <div className="hdr-in">
          <div className="hdr-logo">
            <span className="hdr-icon">ğŸ¹</span>
            <div>
              <div className="hdr-title">×× ×”×œ ×”×–×× ×•×ª <span className={`sync-dot${connected?'':' off'}`} title={connected?'××—×•×‘×¨ ×œ×¢× ×Ÿ':'×× ×•×ª×§'}/></div>
              <div className="hdr-sub">×©×§×™×•×ª ×§×•×§×˜×™×™×œ ×œ××™×¨×•×¢×™× {connected?'â€¢ ××—×•×‘×¨ ×œ×¢× ×Ÿ â˜ï¸':'â€¢ ×× ×•×ª×§'}</div>
            </div>
          </div>
          <button className="btn btn-white" onClick={handleAdd}>+ ×”×–×× ×” ×—×“×©×”</button>
        </div>
      </header>

      <nav className="tabs">
        <div className="tabs-in">
          {TABS.map(t=><button key={t.id} className={`tab ${tab===t.id?'act':''}`} onClick={()=>setTab(t.id)}>{t.label}</button>)}
        </div>
      </nav>

      <main className="main">
        {tab==='dashboard' && <Dashboard orders={orders} settings={settings} onUpdateSettings={handleUpdateSettings} onAdd={handleAdd} onEdit={handleEdit}/>}
        {tab==='orders'    && <OrdersTable orders={filtered} allOrders={orders} filters={filters} onFilter={setFilters} onEdit={handleEdit} onDelete={handleDelete} onAdd={handleAdd} onQuickUpdate={handleQuickUpdate}/>}
        {tab==='monthly'   && <MonthlyStats orders={orders} settings={settings} onUpdateSettings={handleUpdateSettings}/>}
        {tab==='calendar'  && <CalendarView orders={orders} onEdit={handleEdit}/>}
        {tab==='finance'   && <TransactionsView transactions={transactions} onAdd={handleAddTransaction} onDelete={handleDeleteTransaction}/>}
      </main>

      {showForm && <OrderForm order={editing} onSave={handleSave} onClose={handleClose}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js');
    });
  }
</script>
</body>
</html>
